!function(){"use strict";function e(e,t,i,s){if(!e||"string"!=typeof e)throw new Error("Please specify tag of the element");const a=document.createElement(`${e}`);if(t){if(!Array.isArray(t))throw new Error("Classes object should be an array");a.classList.add(...t)}if(i){if("string"!=typeof i)throw new Error("Content should be a string");a.innerText=i}if(s){if("string"!=typeof s)throw new Error("Id should be a string");a.setAttribute("id",`${s}`)}return a}var t={english:[{code:"Backquote",default:"`",shift:"~"},{code:"Digit1",default:"1",shift:"!"},{code:"Digit2",default:"2",shift:"@"},{code:"Digit3",default:"3",shift:"#"},{code:"Digit4",default:"4",shift:"$"},{code:"Digit5",default:"5",shift:"%"},{code:"Digit6",default:"6",shift:"^"},{code:"Digit7",default:"7",shift:"&"},{code:"Digit8",default:"8",shift:"*"},{code:"Digit9",default:"9",shift:"("},{code:"Digit0",default:"0",shift:")"},{code:"Minus",default:"-",shift:"_"},{code:"Equal",default:"=",shift:"+"},{code:"Backspace",default:"Backspace",shift:null},{code:"Tab",default:"Tab",shift:null},{code:"KeyQ",default:"q",shift:"Q"},{code:"KeyW",default:"w",shift:"W"},{code:"KeyE",default:"e",shift:"E"},{code:"KeyR",default:"r",shift:"R"},{code:"KeyT",default:"t",shift:"T"},{code:"KeyY",default:"y",shift:"Y"},{code:"KeyU",default:"u",shift:"U"},{code:"KeyI",default:"i",shift:"I"},{code:"KeyO",default:"o",shift:"O"},{code:"KeyP",default:"p",shift:"P"},{code:"BracketLeft",default:"[",shift:"{"},{code:"BracketRight",default:"]",shift:"}"},{code:"Backslash",default:"\\",shift:"|"},{code:"Delete",default:"Del",shift:null},{code:"CapsLock",default:"CapsLock",shift:null},{code:"KeyA",default:"a",shift:"A"},{code:"KeyS",default:"s",shift:"S"},{code:"KeyD",default:"d",shift:"D"},{code:"KeyF",default:"f",shift:"F"},{code:"KeyG",default:"g",shift:"G"},{code:"KeyH",default:"h",shift:"H"},{code:"KeyJ",default:"j",shift:"J"},{code:"KeyK",default:"k",shift:"K"},{code:"KeyL",default:"l",shift:"L"},{code:"Semicolon",default:";",shift:":"},{code:"Quote",default:"'",shift:'"'},{code:"Enter",default:"Enter",shift:null},{code:"ShiftLeft",default:"Shift",shift:null},{code:"KeyZ",default:"z",shift:"Z"},{code:"KeyX",default:"x",shift:"X"},{code:"KeyC",default:"c",shift:"C"},{code:"KeyV",default:"v",shift:"V"},{code:"KeyB",default:"b",shift:"B"},{code:"KeyN",default:"n",shift:"N"},{code:"KeyM",default:"m",shift:"M"},{code:"Comma",default:",",shift:"<"},{code:"Period",default:".",shift:">"},{code:"Slash",default:"/",shift:"?"},{code:"ArrowUp",default:"⇧",shift:null},{code:"ShiftRight",default:"Shift",shift:null},{code:"ControlLeft",default:"Ctrl",shift:null},{code:"MetaLeft",default:"Win",shift:null},{code:"AltLeft",default:"Alt",shift:null},{code:"Space",default:" ",shift:null},{code:"AltRight",default:"Alt",shift:null},{code:"ArrowLeft",default:"⇦",shift:null},{code:"ArrowDown",default:"⇩",shift:null},{code:"ArrowRight",default:"⇨",shift:null},{code:"ControlRight",default:"Ctrl",shift:null}],russian:[{code:"Backquote",default:"ё",shift:"Ё"},{code:"Digit1",default:"1",shift:"!"},{code:"Digit2",default:"2",shift:'"'},{code:"Digit3",default:"3",shift:"№"},{code:"Digit4",default:"4",shift:";"},{code:"Digit5",default:"5",shift:"%"},{code:"Digit6",default:"6",shift:":"},{code:"Digit7",default:"7",shift:"?"},{code:"Digit8",default:"8",shift:"*"},{code:"Digit9",default:"9",shift:"("},{code:"Digit0",default:"0",shift:")"},{code:"Minus",default:"-",shift:"_"},{code:"Equal",default:"=",shift:"+"},{code:"Backspace",default:"Backspace",shift:null},{code:"Tab",default:"Tab",shift:null},{code:"KeyQ",default:"й",shift:"Й"},{code:"KeyW",default:"ц",shift:"Ц"},{code:"KeyE",default:"у",shift:"У"},{code:"KeyR",default:"к",shift:"К"},{code:"KeyT",default:"е",shift:"Е"},{code:"KeyY",default:"н",shift:"Н"},{code:"KeyU",default:"г",shift:"Г"},{code:"KeyI",default:"ш",shift:"Ш"},{code:"KeyO",default:"щ",shift:"Щ"},{code:"KeyP",default:"з",shift:"З"},{code:"BracketLeft",default:"х",shift:"Х"},{code:"BracketRight",default:"ъ",shift:"Ъ"},{code:"Backslash",default:"\\",shift:"/"},{code:"Delete",default:"Del",shift:null},{code:"CapsLock",default:"CapsLock",shift:null},{code:"KeyA",default:"ф",shift:"Ф"},{code:"KeyS",default:"ы",shift:"Ы"},{code:"KeyD",default:"в",shift:"В"},{code:"KeyF",default:"а",shift:"А"},{code:"KeyG",default:"п",shift:"П"},{code:"KeyH",default:"р",shift:"Р"},{code:"KeyJ",default:"о",shift:"О"},{code:"KeyK",default:"л",shift:"Л"},{code:"KeyL",default:"д",shift:"Д"},{code:"Semicolon",default:"ж",shift:"Ж"},{code:"Quote",default:"э",shift:"Э"},{code:"Enter",default:"Enter",shift:null},{code:"ShiftLeft",default:"Shift",shift:null},{code:"KeyZ",default:"я",shift:"Я"},{code:"KeyX",default:"ч",shift:"Ч"},{code:"KeyC",default:"с",shift:"С"},{code:"KeyV",default:"м",shift:"М"},{code:"KeyB",default:"и",shift:"И"},{code:"KeyN",default:"т",shift:"Т"},{code:"KeyM",default:"ь",shift:"Ь"},{code:"Comma",default:"б",shift:"Б"},{code:"Period",default:"ю",shift:"Ю"},{code:"Slash",default:".",shift:","},{code:"ArrowUp",default:"⇧",shift:null},{code:"ShiftRight",default:"Shift",shift:null},{code:"ControlLeft",default:"Ctrl",shift:null},{code:"MetaLeft",default:"Win",shift:null},{code:"AltLeft",default:"Alt",shift:null},{code:"Space",default:" ",shift:null},{code:"AltRight",default:"Alt",shift:null},{code:"ArrowLeft",default:"⇦",shift:null},{code:"ArrowDown",default:"⇩",shift:null},{code:"ArrowRight",default:"⇨",shift:null},{code:"ControlRight",default:"Ctrl",shift:null}]};class i{constructor(e){if(!e&&!e.default)throw new Error("Please proreply specify properties of key");this.properties={...e},this.element=null}init(){const t=e("button",["key"]);t.setAttribute("type","button"),t.innerText=this.properties.default,this.element=t}reinitialize(e,t=!1,i=!1){if(!e||"object"!=typeof e)throw new Error("No property object specified");this.properties={...e};const s=1===this.element.innerText.length&&this.element.innerText.toLowerCase()!==this.element.innerText.toUpperCase(),a=Boolean(this.properties.shift);this.element.innerText=t&&s||i&&a?this.properties.shift:this.properties.default}addSize(){const e=this.element,t=this.properties.code;["Tab","Delete","ControlLeft","MetaLeft","AltLeft"].includes(t)&&e.classList.add("key--medium"),["Enter","ShiftRight"].includes(t)&&e.classList.add("key--extra-medium"),["CapsLock","Backspace","ShiftLeft"].includes(t)&&e.classList.add("key--wide"),"Space"===t&&e.classList.add("key--extra-wide")}addColor(){const e=this.element,t=this.properties.code;["CapsLock","Backspace","Tab","Enter","Delete"].includes(t)&&e.classList.add("key--grey"),t.startsWith("Alt")&&e.classList.add("key--blue"),t.startsWith("Meta")&&e.classList.add("key--purple"),t.startsWith("Control")&&e.classList.add("key--scarlet"),t.startsWith("Shift")&&e.classList.add("key--yellow"),t.startsWith("Arrow")&&e.classList.add("key--peach")}}class s{constructor(){this.keyboardElement=null,this.typingBoard=null,this.keys=[],this.languages=["english","russian"],this.currentLanguage="english",this.currentLanguageIndex=0,this.rows=[],this.rowEnds=[14,29,42,55,64],this.properties={value:"",capsLock:!1},this.funcKeys={capsLock:!1,shift:new Set,alt:new Set},this.keyLayouts={...t}}init(){this.keyboardElement=e("div",["keyboard"],null,"keyboard"),document.addEventListener("keydown",(e=>this.handlerWrapper(e))),document.addEventListener("keyup",(e=>this.handlerWrapper(e))),this.keyboardElement.addEventListener("pointerdown",(e=>this.handlerWrapper(e))),this.keyboardElement.addEventListener("pointerup",(e=>this.handlerWrapper(e))),this.createKeys(),this.createRows(),this.keyboardElement.append(...this.rows),this.createTypingBoard()}createKeys(){this.keyLayouts[this.currentLanguage].forEach((e=>{const t=new i(e);t.init(),t.addSize(),t.addColor(),t.element.dataset.code=e.code,this.keys.push(t)}))}createRows(){let t=0;this.rowEnds.forEach((i=>{const s=e("div",["keyboard__row"]);for(;t<i;)s.append(this.keys[t].element),t+=1;this.rows.push(s)}))}createTypingBoard(){const t=e("textarea",["typing-board"],null,"typing-board");t.setAttribute("placeholder","Try to type anything..."),t.setAttribute("cols","50"),t.setAttribute("spellcheck","false"),t.setAttribute("autocorrect","off"),this.typingBoard=t}handlerWrapper(e){let t;if(e.type.startsWith("key")){if(t=this.keys.find((t=>t.properties.code===e.code)),!t)return;this.handler(t,e)}if(e.type.startsWith("pointer")){if(!e.target.closest(".key"))return;if(t=this.keys.find((t=>t.properties.code===e.target.dataset.code)),!t)return;this.handler(t,e)}}handler(e,t){const{type:i,repeat:s}=t,{default:a,code:d}=e.properties,n=e.element;if(t.preventDefault(),this.typingBoard.focus(),i.endsWith("down")){if("CapsLock"!==a||s||this.toggleCapsLock(),"Shift"!==a||s||this.funcKeys.shift.size||this.toggleShift("shift"),("Shift"===a||"Alt"===a)&&!s){const e=a.toLowerCase();this.funcKeys[e].has(d)||this.funcKeys[e].add(d),this.funcKeys.shift.size&&this.funcKeys.alt.size&&(this.currentLanguageIndex+=1,this.currentLanguageIndex>1&&(this.currentLanguageIndex=0),this.switchLanguage(this.currentLanguageIndex))}if(i.startsWith("pointer")){const e=t=>{this.handlerWrapper(t),n.removeEventListener("pointerleave",e)};n.addEventListener("pointerleave",e)}e.element.classList.add("key--active"),this.print(e)}if(i.endsWith("up")||i.endsWith("leave")){if("CapsLock"===a&&this.funcKeys.capsLock)return;if("Shift"===a||a.startsWith("Alt")){const e=a.toLowerCase();this.funcKeys[e].delete(d)}if("Shift"===a)return this.funcKeys.shift.clear(),this.toggleShift("default"),void this.keys.forEach((e=>{e.properties.code.startsWith("Shift")&&e.element.classList.remove("key--active")}));e.element.classList.remove("key--active")}}print(e){let t=this.typingBoard.selectionStart;const i=this.typingBoard.value.slice(0,t),s=this.typingBoard.value.slice(t),{code:a}=e.properties;if(!a.match(/(Caps)|(Alt)|(Shift)|(Control)|(Meta)/g)){if(a.match(/(ArrowUp)/)){const e=i.split("\n"),s=e[e.length-2];if(!s&&""!==s)return t=0,void this.typingBoard.setSelectionRange(t,t);const a=e[e.length-1].length;t-=s.length<a?a+"\n".length:s.length+"\n".length}if(a.match(/(ArrowDown)/)){const e=s.split("\n"),a=e[1];if(!a&&""!==a)return t=this.typingBoard.value.length,void this.typingBoard.setSelectionRange(t,t);const d=i.split("\n"),n=d[d.length-1],o=e[0],l=n.length,r=o.length;t+=a.length<l?r+"\n".length+a.length:r+"\n".length+l}if(a.match(/(ArrowLeft)/)&&(t-=1,t<0&&(t=0)),a.match(/(ArrowRight)/)&&(t+=1),a.match(/(Arrow)/))this.typingBoard.setSelectionRange(t,t);else{switch(a){case"Space":this.typingBoard.value=`${i} ${s}`,t+=1;break;case"Tab":this.typingBoard.value=`${i}    ${s}`,t+=4;break;case"Enter":this.typingBoard.value=`${i}\n${s}`,t+=1;break;case"Backspace":this.typingBoard.value=i.slice(0,-1)+s,t-=1;break;case"Delete":this.typingBoard.value=i+s.slice(1);break;default:this.typingBoard.value=i+e.element.innerText+s,t+=1}this.typingBoard.setSelectionRange(t,t)}}}switchLanguage(e){if(e<0||e>this.languages.length)throw new Error("Please enter correct index of new language. Possible options: 0 - english; 1 - russian");this.currentLanguageIndex=e,this.currentLanguage=this.languages[e];const t=[...this.keyLayouts[this.currentLanguage]],i=this.funcKeys.capsLock,s=this.funcKeys.shiftLeft||this.funcKeys.shiftRight;this.keys.forEach(((e,a)=>e.reinitialize(t[a],i,s)))}toggleCapsLock(){this.funcKeys.capsLock?this.funcKeys.capsLock=!1:this.funcKeys.capsLock=!0,this.keys.forEach((e=>{const t=e.element,i=e.element.innerText,s=1===i.length&&i.toLowerCase()!==i.toUpperCase();s&&(this.funcKeys.capsLock?t.innerText=i.toUpperCase():t.innerText=i.toLowerCase()),s&&this.funcKeys.shift.size&&(this.funcKeys.capsLock?t.innerText=i.toLowerCase():t.innerText=i.toUpperCase())}))}toggleShift(e){if(!["default","shift"].includes(e))throw new Error("Please enter correct text option");this.keys.forEach((t=>{const i=t.element,s=i.innerText,a=1===s.length&&s.toLowerCase()!==s.toUpperCase();t.properties[e]?i.innerText=t.properties[e]:i.innerText=t.properties.default,a&&(this.funcKeys.capsLock?i.innerText=i.innerText.toLowerCase():i.innerText=i.innerText.toUpperCase()),a&&"default"===e&&(this.funcKeys.capsLock?i.innerText=i.innerText.toUpperCase():i.innerText=i.innerText.toLowerCase())}))}}window.addEventListener("DOMContentLoaded",(()=>{const t=document.querySelector("body");t.innerHTML="",t.classList.add("body"),t.append(function(){const t=e("header",["header"]),i=e("div",["container","container--header"]),s=e("h1",["heading","container--header__heading"],"Virtual Keyboard. |"),a=e("p",["subheading"],"Made for Windows OS"),d=e("p",["subheading"],"Change language: Shift + Alt");return i.append(s,a,d),t.append(i),t}(),function(){const t=e("main",["main"],null,"main"),i=e("div",["container","container--main"]);return t.append(i),t}(),function(){const t=e("footer",["footer"]),i=e("div",["container","container--footer"]),s=e("div",["about-me"]),a=e("a",["link","about-me__link"],"antiqqt");a.setAttribute("href","https://github.com/antiqqt");const d=e("p",["subheading"],"2022"),n=e("a",["link","about-me__link"],"RS School");return n.setAttribute("href","https://rs.school/"),s.append(a,d,n),i.append(s),t.append(i),t}());const i=new s;i.init();let a=("preferredLanguageIndex",JSON.parse(window.localStorage.getItem("preferredLanguageIndex")));a&&i.switchLanguage(a),document.querySelector("#main").firstElementChild.append(i.typingBoard,i.keyboardElement),window.addEventListener("unload",(()=>{var e;a=i.currentLanguageIndex,e=a,window.localStorage.setItem("preferredLanguageIndex",JSON.stringify(e))}))}))}();